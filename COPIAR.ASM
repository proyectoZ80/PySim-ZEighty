CPU "Z80.TBL"
HOF "INT8"

LD IX,1010H; APUNTA AL INICIO DE BLOQUE
LD IY,1010H
LD A,(1000H)
LD H,A; GUARDA EL TAMAÑO DE LA CADENA
LD A,(1002H)
LD D,A; GUARDA EL TAMAÑO DE LA MEMORIA
LD A,(1003H)
LD C,A; GUARDA LA POSICION EN LA QUE SE COPIARA LA CADENA
LD B,0

ADD IX,BC; SE RECORRE IX HASTA LA POSICION EN LA QE SE COPIARA LA CADENA

E2: LD A,(IX+0)
CP 0
JP Z,E1; A PARTIR DE AQUI, SE ENCUENTRA UNA LOCALIDAD VACIA Y B-1 TENDRA LA ULTIMA LOCALIDAD OCUPADA
INC B
INC C
INC IX
LD A,C
CP D; VERIFICAMOS SI YA SE REVISARON TODAS LAS LOCALIDADES
JP Z,ERROR; SI B=D, NO HAY LOCALIDADES VACIAS
JP E2

E1: LD A,D
SUB C; OBTENEMOS EL NUMERO DE LOCALIDADES DISPONIBLES
CP H
JP M,ERROR; SI LAS LOCALIDADES VACIAS SON MENORES AL TAMAÑO DE LA CADENA, MARCAMOS ERROR
LD A,(1003H)
CP C
JP Z,E5; SI LA PRIMER LOCALIDAD VACIA ES DONDE VAMOS A COPIAR LA CADENA, PROCEDEMOS A COPIARLA DIRECTAMENTE
DEC C
DEC IX
LD A,C
ADD A,H
LD E,A;EN E GUARDAMOS LA POSICION HASTA LA QUE RECORREREMOS LO QUE SE ENCUENTRA EN LAS LOCALIDADES OCUPADAS

LD D,0
ADD IY,DE; RECORREMOS IY HASTA LA POSICION EN LA QUE RECORREREMOS LOCALIDADES OCUPADAS

E3: LD A,(IX+0); AQUI COMENZAMOS A RECORRER LAS LOCALIDADES OCUPADAS
LD (IY+0),A
DEC IX
DEC IY
DEC B
JP NZ,E3
INC IX

E5: LD A,(1001H)
LD C,A
LD IY,1010H; IY VUELVE A APUNTAR AL INICIO DE LA MEMORIA
ADD IY,BC; RECORREMOS IY HASTA LA POSICION EN DONDE SE ENCUENTRA LA CADENA A COPIAR

E4: LD A,(IY+0); AQUI COMENZAMOS A COPIAR LA CADENA EN LA POSICION SOLICITADA
LD (IX+0),A
INC IY
INC IX
DEC H
JP NZ,E4
FIN: HALT
ERROR: LD A,20H
LD (1004H),A
JP FIN